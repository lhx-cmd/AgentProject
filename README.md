# Multi-Agent Tool-Use Dialogue Synthesis System

ä¸€ä¸ªåŸºäºå¤šAgentæ¡†æ¶çš„å·¥å…·ä½¿ç”¨å¯¹è¯åˆæˆç³»ç»Ÿï¼Œç”¨äºç”Ÿæˆé«˜è´¨é‡ã€æ¨ç†å¢å¼ºçš„å¤šè½®å¯¹è¯è®­ç»ƒæ•°æ®ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„å·¥å…·ä½¿ç”¨å¯¹è¯æ•°æ®åˆæˆæµç¨‹ï¼Œé€šè¿‡å›¾æ„å»ºã€éšæœºæ¸¸èµ°é‡‡æ ·ã€å¤šAgentäº¤äº’å’Œè´¨é‡è¿‡æ»¤ç­‰æŠ€æœ¯ï¼Œç”ŸæˆåŒ…å«ä¸°å¯Œæ¨ç†ç—•è¿¹çš„é«˜è´¨é‡å¯¹è¯æ•°æ®ã€‚ç³»ç»Ÿæ”¯æŒå¤æ‚çš„å¤šè½®äº¤äº’ã€å·¥å…·é“¾è°ƒç”¨ã€å‚æ•°ä¼ é€’å’Œè‡ªçº æ­£ç­‰çœŸå®åœºæ™¯ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **å‡½æ•°å›¾æ„å»º**ï¼šåŸºäºå‚æ•°ç›¸å…³æ€§æ„å»ºæœ‰å‘å‡½æ•°å›¾ï¼Œæ¨¡æ‹ŸçœŸå®å·¥å…·çš„è¾“å…¥-è¾“å‡ºå…¼å®¹æ€§
- **æ™ºèƒ½é‡‡æ ·**ï¼šé€šè¿‡éšæœºæ¸¸èµ°ç”Ÿæˆé€»è¾‘è¿è´¯çš„å·¥å…·é“¾åºåˆ—
- **å¤šAgentäº¤äº’**ï¼šUser Agentã€Assistant Agentå’ŒTool AgentååŒå·¥ä½œï¼Œæ¨¡æ‹ŸçœŸå®å¯¹è¯åœºæ™¯
- **æ¨ç†å¢å¼º**ï¼šç”ŸæˆåŒ…å«Chain-of-Thoughtæ¨ç†è¿‡ç¨‹çš„å¯¹è¯è½¨è¿¹
- **ä¸¤é˜¶æ®µè¿‡æ»¤**ï¼šè½¨è¿¹çº§åˆ«å’Œè½®æ¬¡çº§åˆ«çš„è´¨é‡æ§åˆ¶ï¼Œç¡®ä¿æ•°æ®é«˜è´¨é‡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åˆæˆæµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. å‡½æ•°æ”¶é›†ä¸ç²¾ç‚¼ (PrepareData.py)                          â”‚
â”‚     â”œâ”€ ä»å¼€æºæ•°æ®é›†æ”¶é›†20k+å‡½æ•°                              â”‚
â”‚     â”œâ”€ å»é‡ä¸æ¸…æ´—                                            â”‚
â”‚     â””â”€ å‚æ•°æ ‡å‡†åŒ–                                            â”‚
â”‚                                                              â”‚
â”‚  2. å‡½æ•°å›¾æ„å»º (FunctionGraph.py)                            â”‚
â”‚     â”œâ”€ èŠ‚ç‚¹ï¼šå‡½æ•°/å·¥å…·                                       â”‚
â”‚     â”œâ”€ è¾¹ï¼šå‚æ•°ç±»å‹åŒ¹é…å…³ç³»                                  â”‚
â”‚     â””â”€ æœ‰å‘å›¾è¡¨ç¤ºå·¥å…·ä¾èµ–                                    â”‚
â”‚                                                              â”‚
â”‚  3. éšæœºæ¸¸èµ°é‡‡æ · (RandomWalkSampling.py)                     â”‚
â”‚     â”œâ”€ åœ¨å‡½æ•°å›¾ä¸Šæ‰§è¡Œéšæœºæ¸¸èµ°                                â”‚
â”‚     â”œâ”€ ç”Ÿæˆé•¿åº¦2-10çš„å·¥å…·é“¾                                  â”‚
â”‚     â””â”€ ç¡®ä¿é€»è¾‘è¿è´¯æ€§                                        â”‚
â”‚                                                              â”‚
â”‚  4. å¤šAgentå¯¹è¯åˆæˆ (MultiAgentDialogueSynthesis.py)         â”‚
â”‚     â”œâ”€ User Agentï¼šç”Ÿæˆç”¨æˆ·æŸ¥è¯¢                              â”‚
â”‚     â”œâ”€ Assistant Agentï¼šæ¨ç†+å·¥å…·è°ƒç”¨                        â”‚
â”‚     â”œâ”€ Tool Agentï¼šæ¨¡æ‹Ÿå·¥å…·æ‰§è¡Œ                              â”‚
â”‚     â””â”€ ç”Ÿæˆå¤šè½®äº¤äº’è½¨è¿¹                                      â”‚
â”‚                                                              â”‚
â”‚  5. è´¨é‡è¿‡æ»¤ (QualityFiltering.py)                           â”‚
â”‚     â”œâ”€ è½¨è¿¹çº§åˆ«è¿‡æ»¤                                          â”‚
â”‚     â”œâ”€ è½®æ¬¡çº§åˆ«è¿‡æ»¤                                          â”‚
â”‚     â””â”€ è¾“å‡ºé«˜è´¨é‡æ•°æ®                                        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
AgentProject/
â”œâ”€â”€ code/
â”‚   â”œâ”€â”€ PrepareData.py                    # æ•°æ®é¢„å¤„ç†ä¸å‡½æ•°ç²¾ç‚¼
â”‚   â”œâ”€â”€ FunctionGraph.py                  # å‡½æ•°å›¾æ„å»º
â”‚   â”œâ”€â”€ RandomWalkSampling.py             # éšæœºæ¸¸èµ°é‡‡æ ·
â”‚   â”œâ”€â”€ MultiAgentDialogueSynthesis.py    # å¤šAgentå¯¹è¯åˆæˆ
â”‚   â””â”€â”€ QualityFiltering.py               # è´¨é‡è¿‡æ»¤
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ ToolACE-query.jsonl               # åŸå§‹å·¥å…·æ•°æ®
â”‚   â”œâ”€â”€ refined_tools.json                # ç²¾ç‚¼åçš„å·¥å…·
â”‚   â”œâ”€â”€ function_graph.json               # å‡½æ•°å›¾
â”‚   â”œâ”€â”€ sampled_tool_chains.json          # é‡‡æ ·çš„å·¥å…·é“¾
â”‚   â”œâ”€â”€ synthesized_dialogues.json        # åˆæˆçš„å¯¹è¯
â”‚   â””â”€â”€ filtered_dialogues.json           # è¿‡æ»¤åçš„é«˜è´¨é‡å¯¹è¯
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- ä¾èµ–åŒ…ï¼š
  ```bash
  pip install networkx
  ```

### å®Œæ•´æµç¨‹

#### æ­¥éª¤1: æ•°æ®é¢„å¤„ç†

ä»åŸå§‹æ•°æ®ä¸­æå–å’Œç²¾ç‚¼å·¥å…·æè¿°ï¼š

```bash
python code/PrepareData.py
```

**è¾“å…¥**ï¼š`data/ToolACE-query.jsonl`  
**è¾“å‡º**ï¼š`data/refined_tools.json`

**åŠŸèƒ½**ï¼š
- è§£æJSONLæ ¼å¼çš„å·¥å…·æ•°æ®
- æå–å‡½æ•°åã€æè¿°ã€å‚æ•°ä¿¡æ¯
- å»é‡å’ŒéªŒè¯
- æ ‡å‡†åŒ–å‚æ•°schema

#### æ­¥éª¤2: æ„å»ºå‡½æ•°å›¾

åŸºäºå‚æ•°ç›¸å…³æ€§æ„å»ºæœ‰å‘å‡½æ•°å›¾ï¼š

```bash
python code/FunctionGraph.py
```

**è¾“å…¥**ï¼š`data/refined_tools.json`  
**è¾“å‡º**ï¼š`data/function_graph.json`

**åŠŸèƒ½**ï¼š
- åˆ†æå‡½æ•°å‚æ•°ç±»å‹
- æ„å»ºå‚æ•°åŒ¹é…å…³ç³»
- ç”Ÿæˆæœ‰å‘è¾¹ï¼ˆè¾“å‡ºâ†’è¾“å…¥ï¼‰
- æ”¯æŒç±»å‹å…¼å®¹æ€§æ£€æŸ¥

#### æ­¥éª¤3: éšæœºæ¸¸èµ°é‡‡æ ·

åœ¨å‡½æ•°å›¾ä¸Šé‡‡æ ·å·¥å…·é“¾ï¼š

```bash
python code/RandomWalkSampling.py
```

**è¾“å…¥**ï¼š`data/function_graph.json`  
**è¾“å‡º**ï¼š`data/sampled_tool_chains.json`

**åŠŸèƒ½**ï¼š
- éšæœºé€‰æ‹©èµ·å§‹èŠ‚ç‚¹
- æ‰§è¡Œéšæœºæ¸¸èµ°ï¼ˆé•¿åº¦2-10ï¼‰
- ç”Ÿæˆå¤šæ ·åŒ–å·¥å…·é“¾
- ç¡®ä¿é“¾çš„è¿è´¯æ€§

#### æ­¥éª¤4: å¤šAgentå¯¹è¯åˆæˆ

ä½¿ç”¨å¤šAgentæ¡†æ¶ç”Ÿæˆå¯¹è¯ï¼š

```bash
python code/MultiAgentDialogueSynthesis.py
```

**è¾“å…¥**ï¼š
- `data/refined_tools.json`
- `data/sampled_tool_chains.json`

**è¾“å‡º**ï¼š`data/synthesized_dialogues.json`

**åŠŸèƒ½**ï¼š
- User Agentç”ŸæˆæŸ¥è¯¢
- Assistant Agentæ¨ç†å’Œè§„åˆ’
- Tool Agentæ¨¡æ‹Ÿæ‰§è¡Œ
- ç”Ÿæˆå¤šè½®äº¤äº’è½¨è¿¹
- åŒ…å«Chain-of-Thoughtæ¨ç†

#### æ­¥éª¤5: è´¨é‡è¿‡æ»¤

å¯¹åˆæˆçš„å¯¹è¯è¿›è¡Œä¸¤é˜¶æ®µè¿‡æ»¤ï¼š

```bash
python code/QualityFiltering.py
```

**è¾“å…¥**ï¼š`data/synthesized_dialogues.json`  
**è¾“å‡º**ï¼š`data/filtered_dialogues.json`

**åŠŸèƒ½**ï¼š
- è½¨è¿¹çº§åˆ«è¿‡æ»¤ï¼ˆå®Œæ•´æ€§ã€æˆåŠŸæ€§ï¼‰
- è½®æ¬¡çº§åˆ«è¿‡æ»¤ï¼ˆæ¨ç†è´¨é‡ã€å·¥å…·æœ‰æ•ˆæ€§ï¼‰
- ç§»é™¤é”™è¯¯å’Œæ¬¡ä¼˜æ­¥éª¤
- ä¿ç•™è‡ªçº æ­£ä¿¡å·

## ğŸ“Š æ•°æ®æ ¼å¼

### ç²¾ç‚¼å·¥å…·æ ¼å¼

```json
{
  "function_name": "Get Weather",
  "description": "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
  "parameters": [
    {
      "name": "city",
      "type": "string",
      "description": "åŸå¸‚åç§°",
      "required": true
    }
  ],
  "raw_schema": { ... }
}
```

### å·¥å…·é“¾æ ¼å¼

```json
{
  "length": 4,
  "chain": [
    "Search Location",
    "Get Weather",
    "Get Forecast",
    "Send Notification"
  ]
}
```

### å¯¹è¯æ ¼å¼

```json
{
  "UserContent": "å¸®æˆ‘æŸ¥ä¸€ä¸‹åŒ—äº¬æ˜å¤©çš„å¤©æ°”",
  "ToolChain": ["Search Location", "Get Weather", "Get Forecast"],
  "conversation": [
    {
      "role": "user",
      "content": "å¸®æˆ‘æŸ¥ä¸€ä¸‹åŒ—äº¬æ˜å¤©çš„å¤©æ°”",
      "turn": 1
    },
    {
      "role": "assistant",
      "content": "æˆ‘å°†è°ƒç”¨ Search Location æ¥å¸®åŠ©æ‚¨",
      "reasoning": [
        "ç”¨æˆ·éœ€è¦æŸ¥è¯¢åŒ—äº¬çš„å¤©æ°”ä¿¡æ¯",
        "é¦–å…ˆéœ€è¦ç¡®å®šåŒ—äº¬çš„åœ°ç†ä½ç½®",
        "é€‰æ‹©å·¥å…·ï¼šSearch Location"
      ],
      "tool_call": {
        "tool_name": "Search Location",
        "parameters": {
          "query": "åŒ—äº¬"
        }
      },
      "turn": 2
    },
    {
      "role": "tool",
      "tool_name": "Search Location",
      "tool_result": {
        "status": "success",
        "data": {
          "city": "åŒ—äº¬",
          "lat": 39.9042,
          "lon": 116.4074
        }
      },
      "turn": 3
    }
  ],
  "chain_length": 3,
  "total_turns": 7,
  "assistant_turns": 3
}
```

## ğŸ” æ ¸å¿ƒæŠ€æœ¯

### 1. å‡½æ•°å›¾æ„å»º

**å‚æ•°åŒ¹é…è§„åˆ™**ï¼š
- ç²¾ç¡®ç±»å‹åŒ¹é…ï¼š`string â†’ string`
- å…¼å®¹ç±»å‹åŒ¹é…ï¼š`int â†’ float`
- è¯­ä¹‰åŒ¹é…ï¼š`user_id â†’ id`

**è¾¹æƒé‡è®¡ç®—**ï¼š
```python
weight = parameter_type_match_score + semantic_similarity_score
```

### 2. éšæœºæ¸¸èµ°ç­–ç•¥

**æ¸¸èµ°å‚æ•°**ï¼š
- æœ€å°é•¿åº¦ï¼š2
- æœ€å¤§é•¿åº¦ï¼š10
- é‡å¯æ¦‚ç‡ï¼š0.15
- é‡‡æ ·æ•°é‡ï¼šå¯é…ç½®

**ç»ˆæ­¢æ¡ä»¶**ï¼š
- è¾¾åˆ°æœ€å¤§é•¿åº¦
- æ— å¯ç”¨åç»§èŠ‚ç‚¹
- éšæœºé‡å¯

### 3. å¤šAgentäº¤äº’

**User Agent**ï¼š
- åŸºäºå·¥å…·é“¾ç”Ÿæˆè‡ªç„¶æŸ¥è¯¢
- æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ„å›¾
- æ”¯æŒå¤šæ ·åŒ–è¡¨è¾¾

**Assistant Agent**ï¼š
- Chain-of-Thoughtæ¨ç†
- å·¥å…·é€‰æ‹©ä¸å‚æ•°ç”Ÿæˆ
- ä¸Šä¸‹æ–‡å‚æ•°æå–
- ä¸»åŠ¨æ¾„æ¸…æœºåˆ¶

**Tool Agent**ï¼š
- åŸºäºschemaç”Ÿæˆæ¨¡æ‹Ÿç»“æœ
- ä¿æŒæ•°æ®ä¸€è‡´æ€§
- æ”¯æŒæˆåŠŸ/å¤±è´¥åœºæ™¯

### 4. è´¨é‡è¿‡æ»¤

**è½¨è¿¹çº§åˆ«æ£€æŸ¥**ï¼š
- âœ“ å¯¹è¯å®Œæ•´æ€§
- âœ“ å·¥å…·è°ƒç”¨æˆåŠŸç‡
- âœ“ æ¨ç†è¿‡ç¨‹å­˜åœ¨æ€§
- âœ“ è½®æ¬¡åˆç†æ€§
- âœ— è¿‡åº¦æ¾„æ¸…å¾ªç¯

**è½®æ¬¡çº§åˆ«æ£€æŸ¥**ï¼š
- âœ“ æ¨ç†è´¨é‡
- âœ“ å·¥å…·è°ƒç”¨æœ‰æ•ˆæ€§
- âœ“ å†…å®¹å®è´¨æ€§
- âœ“ æ¨ç†-è¡ŒåŠ¨ä¸€è‡´æ€§
- âœ— æ— æ„ä¹‰é‡å¤
- âœ— æ— æ•ˆæ¾„æ¸…å¾ªç¯

## ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯

### æ•°æ®è§„æ¨¡

- **åŸå§‹å·¥å…·æ•°**ï¼š20,000+
- **ç²¾ç‚¼åå·¥å…·æ•°**ï¼š~15,000
- **å‡½æ•°å›¾èŠ‚ç‚¹æ•°**ï¼š~15,000
- **å‡½æ•°å›¾è¾¹æ•°**ï¼š~50,000
- **é‡‡æ ·å·¥å…·é“¾æ•°**ï¼šå¯é…ç½®ï¼ˆå»ºè®®1,000-10,000ï¼‰
- **åˆæˆå¯¹è¯æ•°**ï¼šä¸å·¥å…·é“¾æ•°ç›¸åŒ
- **è¿‡æ»¤åå¯¹è¯æ•°**ï¼šçº¦70-80%é€šè¿‡ç‡

### è´¨é‡æŒ‡æ ‡

- **è½¨è¿¹å®Œæ•´ç‡**ï¼š>95%
- **å·¥å…·è°ƒç”¨æˆåŠŸç‡**ï¼š>70%
- **æ¨ç†è¦†ç›–ç‡**ï¼š100%
- **å¹³å‡å¯¹è¯è½®æ¬¡**ï¼š8-15è½®
- **å¹³å‡å·¥å…·é“¾é•¿åº¦**ï¼š3-5ä¸ªå·¥å…·

## ğŸ› ï¸ é…ç½®é€‰é¡¹

### PrepareData.py

```python
input_file = 'data/ToolACE-query.jsonl'
output_file = 'data/refined_tools.json'
```

### RandomWalkSampling.py

```python
num_chains = 1000          # é‡‡æ ·æ•°é‡
min_length = 2             # æœ€å°é“¾é•¿åº¦
max_length = 10            # æœ€å¤§é“¾é•¿åº¦
restart_prob = 0.15        # é‡å¯æ¦‚ç‡
```

### QualityFiltering.py

```python
max_turns = 50                    # æœ€å¤§è½®æ¬¡
max_clarification_ratio = 0.5     # æœ€å¤§æ¾„æ¸…æ¯”ä¾‹
max_failure_rate = 0.3            # æœ€å¤§å¤±è´¥ç‡
similarity_threshold = 0.8        # é‡å¤æ£€æµ‹é˜ˆå€¼
```

## ğŸ“ åº”ç”¨åœºæ™¯

1. **å·¥å…·ä½¿ç”¨Agentè®­ç»ƒ**ï¼šä¸ºLLMæä¾›é«˜è´¨é‡çš„å·¥å…·è°ƒç”¨è®­ç»ƒæ•°æ®
2. **å¤šè½®å¯¹è¯ç³»ç»Ÿ**ï¼šè®­ç»ƒæ”¯æŒå¤æ‚å¤šè½®äº¤äº’çš„å¯¹è¯æ¨¡å‹
3. **æ¨ç†èƒ½åŠ›å¢å¼º**ï¼šé€šè¿‡CoTæ•°æ®æå‡æ¨¡å‹æ¨ç†èƒ½åŠ›
4. **APIè°ƒç”¨å­¦ä¹ **ï¼šå­¦ä¹ çœŸå®ä¸–ç•Œçš„APIä½¿ç”¨æ¨¡å¼
5. **å‚æ•°ä¼ é€’è®­ç»ƒ**ï¼šè®­ç»ƒæ¨¡å‹ç†è§£å·¥å…·é—´çš„å‚æ•°ä¾èµ–å…³ç³»

## ğŸ“ å¼•ç”¨

å¦‚æœæœ¬é¡¹ç›®å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@software{multi_agent_tool_synthesis,
  title={Multi-Agent Tool-Use Dialogue Synthesis System},
  author={Your Name},
  year={2024},
  url={https://github.com/yourusername/AgentProject}
}
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ”— ç›¸å…³èµ„æº

- [ToolBench](https://github.com/OpenBMB/ToolBench)
- [API-Bank](https://github.com/AlibabaResearch/DAMO-ConvAI/tree/main/api-bank)
- [ToolACE](https://arxiv.org/abs/2401.00000)

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼šyour.email@example.com

---

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®ç”Ÿæˆçš„æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼ŒTool Agentè¿”å›çš„æ˜¯åŸºäºschemaçš„æ¨¡æ‹Ÿç»“æœï¼Œè€ŒéçœŸå®APIè°ƒç”¨ã€‚å¦‚éœ€çœŸå®APIæ•°æ®ï¼Œè¯·æ›¿æ¢Tool Agentå®ç°ã€‚
